language: python
dist: xenial

env:
  global:
  - BINARY_VERSION=$(git describe --tags --dirty --always)

addons:
  artifacts:
    paths:
      - ./dist/mac/ODK-XLSForm-Offline-macOS-${BINARY_VERSION}.zip
      - ./dist/win
    target_paths:
      - ${TRAVIS_BUILD_NUMBER}
    debug: true

matrix:
  include:
    - os: osx
      language: sh
      python: "3.6"
      before_install:
        - brew update
        - brew install unix2dos
        - pip3 install pyinstaller wxpython pyxform
      script:
        - ./make-mac.sh
        - ./make-dist.sh
        - mv ./dist/mac/ODK-XLSForm-Offline-macOS.zip ./dist/mac/ODK-XLSForm-Offline-macOS-${BINARY_VERSION}.zip
    - os: windows
      language: sh
      python: "3.6"
      before_install:
        - choco install python3 --params "/InstallDir:C:\\Python"
        - export PATH="/c/Python:/c/Python/Scripts:$PATH"
        - pip3 install pyinstaller
        - pip3 install pyxform
      script:
        - ./make-win.bat
        - mv ./dist/win/${TRAVIS_BUILD_NUMBER}_ODK\ XLSForm\ Offline.exe ./dist/win/ODK\ XLSForm\ Offline${BINARY_VERSION}.exe

cache: pip
